; PlatformIO Project Configuration File
; SD Card Stress Test for Heltec CubeCell HTCC-AB01
;
; Documentation: https://docs.platformio.org/en/latest/platforms/heltec-cubecell.html
; Board: https://heltec.org/project/htcc-ab01-v2/

[env:cubecell_board]
platform = heltec-cubecell
board = cubecell_board
framework = arduino

; Monitor configuration
monitor_speed = 115200
monitor_filters =
    default
    time
    colorize

; Upload configuration
upload_speed = 921600

; Build flags
build_flags =
    -D SD_STRESS_TEST
    -D SERIAL_DEBUG=1
    ; SPI frequency for SD card (Hz) - start low for stability
    -D SD_SPI_FREQUENCY=4000000
    ; Cycle interval in milliseconds
    -D CYCLE_INTERVAL_MS=1000
    ; Maximum consecutive failures before reboot
    -D MAX_CONSECUTIVE_FAILURES=10
    ; Enable aggressive mode (unmount after each write)
    -D AGGRESSIVE_MODE=1
    ; CSV filename
    -D CSV_FILENAME='"/sd_test.csv"'
    ; Debug level (0=OFF, 1=ERROR, 2=WARN, 3=INFO, 4=DEBUG)
    -D APP_LOG_LEVEL=3

; LoRaWAN disabled for this test (saves resources)
board_build.arduino.lorawan.region = EU868
board_build.arduino.lorawan.class = CLASS_A
board_build.arduino.lorawan.netmode = OTAA
board_build.arduino.lorawan.adr = OFF
board_build.arduino.lorawan.uplinkmode = UNCONFIRMED
board_build.arduino.lorawan.at_support = OFF
board_build.arduino.lorawan.rgb = DEACTIVE
board_build.arduino.lorawan.debug_level = NONE

; Library dependencies
; Note: SdFat n'est pas compatible avec CubeCell (conflit avec le framework Arduino)
; On utilise une impl√©mentation Software SPI native dans sd_controller.cpp
lib_deps =

; Extra scripts (optional, for post-build actions)
; extra_scripts = post:scripts/post_build.py

[env:cubecell_board_debug]
extends = env:cubecell_board
build_type = debug
build_flags =
    ${env:cubecell_board.build_flags}
    -D APP_LOG_LEVEL=4
    -D SD_SPI_FREQUENCY=1000000

[env:cubecell_board_slow_spi]
extends = env:cubecell_board
build_flags =
    ${env:cubecell_board.build_flags}
    -D SD_SPI_FREQUENCY=1000000
    -D APP_LOG_LEVEL=4

[env:cubecell_board_continuous]
extends = env:cubecell_board
build_flags =
    ${env:cubecell_board.build_flags}
    -D AGGRESSIVE_MODE=0
    -D CYCLE_INTERVAL_MS=500
